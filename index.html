<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wandel Tracker 2026 - Custom Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Serif:ital,wght@0,400;0,700;1,400&family=Space+Mono:wght@400;700&family=Quicksand:wght@400;700&family=Caveat:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .canvas-container { max-width: 320px; aspect-ratio: 9 / 16; position: relative; margin: 0 auto; }
        #canvasPreview { width: 100%; height: auto; border-radius: 30px; display: block; z-index: 10; position: relative; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-btn.active { border-bottom: 2px solid #059669; color: #059669; }
        #bgUpload, #logoUpload { display: none; }

        /* Slider styling for all devices */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
            margin-top: -9px; /* Centers thumb on track */
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }
        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
        }
        input[type="range"]::-moz-range-track {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
        }

        /* Mobile-first touch optimizations */
        @media (max-width: 768px) {
            input[type="range"]::-webkit-slider-thumb {
                width: 28px;
                height: 28px;
                box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
                margin-top: -11px; /* Centers larger thumb on track */
            }
            input[type="range"]::-moz-range-thumb {
                width: 28px;
                height: 28px;
                box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
            }
            button, .style-btn {
                min-height: 44px;
                min-width: 44px;
            }
            input[type="text"], input[type="number"] {
                min-height: 44px;
                font-size: 16px !important; /* Prevents iOS zoom on focus */
            }
            select {
                min-height: 44px;
                font-size: 16px !important;
            }
        }

        /* Touch action for better scrolling */
        * { touch-action: manipulation; }

        #resetModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .style-btn.active { background-color: #10b981 !important; color: white !important; border-color: #10b981 !important; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="min-h-screen pb-20 text-slate-800">

    <!-- Bevestigings Modal -->
    <div id="resetModal">
        <div class="bg-white p-8 rounded-3xl max-w-sm w-full mx-4 shadow-2xl border border-slate-100">
            <h2 class="text-xl font-black mb-2 text-slate-900">Start over?</h2>
            <p class="text-slate-500 text-sm mb-6">Dit wist alle kilometers, stappen en stijlen uit je browsergeheugen.</p>
            <div class="flex gap-3">
                <button onclick="toggleResetModal(false)" class="flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-xl hover:bg-slate-200 transition">Annuleren</button>
                <button onclick="resetData()" class="flex-1 py-3 bg-red-600 text-white font-bold rounded-xl shadow-lg shadow-red-100 hover:bg-red-700 transition">Wis alles</button>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto p-4 md:p-10">
        <div class="flex flex-col lg:flex-row gap-8 items-start">

            <!-- CONFIGURATIE PANEEL -->
            <div class="w-full lg:w-3/5 space-y-6">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                    <div class="flex justify-between items-center mb-1">
                        <h1 class="text-2xl font-black text-slate-900 tracking-tight">WALK <span class="text-emerald-600 text-3xl italic">STORY</span></h1>
                    </div>
                    <p class="text-slate-500 text-sm mb-6 italic">Personaliseer je wandeldoelen badge.</p>

                    <!-- Tabs -->
                    <div class="flex border-b border-slate-100 mb-6 font-bold text-xs uppercase tracking-widest text-slate-400 overflow-x-auto">
                        <button onclick="switchTab('data')" id="btn-data" class="tab-btn flex-none px-6 py-3 active transition-all">Stats</button>
                        <button onclick="switchTab('branding')" id="btn-branding" class="tab-btn flex-none px-6 py-3 transition-all">Tekst & Stijl</button>
                        <button onclick="switchTab('style')" id="btn-style" class="tab-btn flex-none px-6 py-3 transition-all">Vormgeving</button>
                    </div>

                    <!-- TAB: DATA -->
                    <div id="tab-data" class="tab-content active space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-xs font-bold text-slate-400 uppercase">Kilometers</label>
                                <input type="number" id="kmInput" value="25" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-bold text-slate-400 uppercase">Doel (km)</label>
                                <input type="number" id="targetInput" value="2026" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-xs font-bold text-slate-400 uppercase">Dag van uitdaging</label>
                                <input type="number" id="dayInput" placeholder="Bijv. 12" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-bold text-slate-400 uppercase">Aantal stappen</label>
                                <input type="number" id="stepsInput" placeholder="Bijv. 1250000" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                            </div>
                        </div>
                    </div>

                    <!-- TAB: BRANDING (Tekst & Stijl) -->
                    <div id="tab-branding" class="tab-content space-y-6">

                        <!-- 1. Koptekst Sectie -->
                        <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100 space-y-4">
                             <div class="flex items-center justify-between">
                                <label class="text-xs font-bold text-slate-500 uppercase tracking-tighter">Grote koptekst (boven)</label>
                                <input type="checkbox" id="showYearInput" checked class="w-5 h-5 accent-emerald-600">
                            </div>
                            <input type="text" id="yearTextInput" value="2026" class="w-full px-4 py-2 bg-white border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                            <div class="space-y-3">
                                <div class="flex flex-wrap gap-2">
                                    <select onchange="setConfig('yearFont', this.value)" id="yearFontSelect" class="flex-1 bg-white border border-slate-200 rounded-lg px-2 py-1 text-xs outline-none">
                                        <option value="Inter">Modern (Sans)</option>
                                        <option value="'Noto Serif'">Klassiek (Serif)</option>
                                        <option value="'Space Mono'">Tracker (Mono)</option>
                                        <option value="'Quicksand'">Zacht (Rounded)</option>
                                        <option value="'Caveat'">Handschrift</option>
                                    </select>
                                    <button onclick="toggleStyle('yearBold')" id="yearBoldBtn" class="style-btn w-10 h-10 border border-slate-200 rounded-lg font-bold bg-white text-xs transition-all">B</button>
                                    <button onclick="toggleStyle('yearItalic')" id="yearItalicBtn" class="style-btn w-10 h-10 border border-slate-200 rounded-lg italic bg-white text-xs transition-all">I</button>
                                </div>
                                <div class="space-y-1">
                                    <div class="flex justify-between items-center">
                                        <label class="text-xs font-bold text-slate-400 uppercase">Grootte Koptekst</label>
                                        <span id="yearSizeLabel" class="text-xs font-bold text-emerald-600">180px</span>
                                    </div>
                                    <input type="range" id="yearSizeSlider" min="50" max="400" value="180" class="w-full rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <!-- 2. Titel Sectie -->
                        <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100 space-y-4">
                            <div class="flex items-center justify-between">
                                <label class="text-xs font-bold text-slate-500 uppercase tracking-tighter">Titel op kaart</label>
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-1">
                                        <span class="text-xs font-bold text-slate-400 uppercase">Toon</span>
                                        <input type="checkbox" id="showTitleInput" checked class="w-5 h-5 accent-emerald-600">
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="text-xs font-bold text-slate-400 uppercase">Vinkje</span>
                                        <input type="checkbox" id="titleCheckInput" class="w-5 h-5 accent-emerald-600">
                                    </div>
                                </div>
                            </div>
                            <input type="text" id="titleInput" value="#ClauWandelt" class="w-full px-4 py-2 bg-white border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                            <div class="space-y-3">
                                <div class="flex flex-wrap gap-2">
                                    <select onchange="setConfig('titleFont', this.value)" id="titleFontSelect" class="flex-1 bg-white border border-slate-200 rounded-lg px-2 py-1 text-xs outline-none">
                                        <option value="Inter">Modern (Sans)</option>
                                        <option value="'Noto Serif'">Klassiek (Serif)</option>
                                        <option value="'Space Mono'">Tracker (Mono)</option>
                                        <option value="'Quicksand'">Zacht (Rounded)</option>
                                        <option value="'Caveat'">Handschrift</option>
                                    </select>
                                    <button onclick="toggleStyle('titleBold')" id="titleBoldBtn" class="style-btn w-10 h-10 border border-slate-200 rounded-lg font-bold bg-white text-xs transition-all">B</button>
                                    <button onclick="toggleStyle('titleItalic')" id="titleItalicBtn" class="style-btn w-10 h-10 border border-slate-200 rounded-lg italic bg-white text-xs transition-all">I</button>
                                </div>
                                <div class="space-y-1">
                                    <div class="flex justify-between items-center">
                                        <label class="text-xs font-bold text-slate-400 uppercase">Grootte Titel</label>
                                        <span id="titleSizeLabel" class="text-xs font-bold text-emerald-600">52px</span>
                                    </div>
                                    <input type="range" id="titleSizeSlider" min="20" max="120" value="52" class="w-full rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <!-- Kilometers Tekst Styling -->
                        <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100 space-y-4">
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-tighter">Kilometers Tekst Styling</label>
                            <div class="space-y-3">
                                <div class="flex flex-wrap gap-2">
                                    <select onchange="setConfig('kmFont', this.value)" id="kmFontSelect" class="flex-1 bg-white border border-slate-200 rounded-lg px-2 py-1 text-xs outline-none">
                                        <option value="Inter">Modern (Sans)</option>
                                        <option value="'Noto Serif'">Klassiek (Serif)</option>
                                        <option value="'Space Mono'">Tracker (Mono)</option>
                                        <option value="'Quicksand'">Zacht (Rounded)</option>
                                        <option value="'Caveat'">Handschrift</option>
                                    </select>
                                    <button onclick="toggleStyle('kmBold')" id="kmBoldBtn" class="style-btn w-10 h-10 border border-slate-200 rounded-lg font-bold bg-white text-xs transition-all active">B</button>
                                    <button onclick="toggleStyle('kmItalic')" id="kmItalicBtn" class="style-btn w-10 h-10 border border-slate-200 rounded-lg italic bg-white text-xs transition-all">I</button>
                                </div>
                                <div class="space-y-1">
                                    <div class="flex justify-between items-center">
                                        <label class="text-xs font-bold text-slate-400 uppercase">Grootte Kilometers Tekst</label>
                                        <span id="kmSizeLabel" class="text-xs font-bold text-emerald-600">85px</span>
                                    </div>
                                    <input type="range" id="kmSizeSlider" min="40" max="150" value="85" class="w-full rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <!-- Doel Tekst Styling -->
                        <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100 space-y-4">
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-tighter">Doel Tekst Styling</label>
                            <div class="space-y-3">
                                <div class="flex flex-wrap gap-2">
                                    <select onchange="setConfig('goalFont', this.value)" id="goalFontSelect" class="flex-1 bg-white border border-slate-200 rounded-lg px-2 py-1 text-xs outline-none">
                                        <option value="Inter">Modern (Sans)</option>
                                        <option value="'Noto Serif'">Klassiek (Serif)</option>
                                        <option value="'Space Mono'">Tracker (Mono)</option>
                                        <option value="'Quicksand'">Zacht (Rounded)</option>
                                        <option value="'Caveat'">Handschrift</option>
                                    </select>
                                    <button onclick="toggleStyle('goalBold')" id="goalBoldBtn" class="style-btn w-10 h-10 border border-slate-200 rounded-lg font-bold bg-white text-xs transition-all active">B</button>
                                    <button onclick="toggleStyle('goalItalic')" id="goalItalicBtn" class="style-btn w-10 h-10 border border-slate-200 rounded-lg italic bg-white text-xs transition-all">I</button>
                                </div>
                                <div class="space-y-1">
                                    <div class="flex justify-between items-center">
                                        <label class="text-xs font-bold text-slate-400 uppercase">Grootte Doel Tekst</label>
                                        <span id="goalSizeLabel" class="text-xs font-bold text-emerald-600">45px</span>
                                    </div>
                                    <input type="range" id="goalSizeSlider" min="20" max="80" value="45" class="w-full rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <!-- 3. Instagram Handle -->
                        <div class="space-y-1 px-4">
                            <label class="text-xs font-bold text-slate-400 uppercase">Instagram @Handle</label>
                            <input type="text" id="handleInput" placeholder="@jouwnaam" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                        </div>

                        <!-- Logo Section -->
                        <div class="p-4 bg-emerald-50/50 rounded-2xl border border-emerald-100 space-y-3">
                            <div class="flex items-center justify-between">
                                <label class="text-xs font-bold text-emerald-700 uppercase">Logo & Doelen</label>
                                <input type="checkbox" id="showLogoInput" class="w-5 h-5 accent-emerald-600">
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setLogoType('fightcancer')" id="logo-fc" class="py-3 text-xs font-bold rounded-lg border-2 border-slate-200 bg-white text-slate-400 hover:border-emerald-200 transition-all">FIGHT CANCER</button>
                                <button onclick="document.getElementById('logoUpload').click()" id="logo-custom" class="py-3 text-xs font-bold rounded-lg border-2 border-slate-200 bg-white text-slate-400 hover:border-emerald-200 transition-all">EIGEN LOGO</button>
                            </div>
                            <input type="file" id="logoUpload" accept="image/*">
                        </div>
                    </div>

                    <!-- TAB: STYLE (Vormgeving) -->
                    <div id="tab-style" class="tab-content space-y-6">

                        <!-- Kaart Instellingen -->
                        <div class="space-y-4 p-4 bg-slate-50 rounded-2xl border border-slate-100">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center"><label class="text-xs font-bold text-slate-500 uppercase">Breedte Kaart</label><span id="widthLabel" class="text-xs font-bold text-emerald-600">100%</span></div>
                                <input type="range" id="widthSlider" min="70" max="110" value="100" class="w-full rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center"><label class="text-xs font-bold text-slate-500 uppercase">Hoogte Kaart</label><span id="heightLabel" class="text-xs font-bold text-emerald-600">90%</span></div>
                                <input type="range" id="heightSlider" min="60" max="130" value="90" class="w-full rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center"><label class="text-xs font-bold text-slate-500 uppercase">Verticale Positie</label><span id="posLabel" class="text-xs font-bold text-emerald-600">Midden</span></div>
                                <input type="range" id="posSlider" min="200" max="1500" value="960" class="w-full rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div class="space-y-3 border-t pt-3 border-slate-200">
                                <div class="flex justify-between items-center"><label class="text-xs font-bold text-slate-500 uppercase">Kaart Doorzichtigheid</label><span id="opacityLabel" class="text-xs font-bold text-emerald-600">90%</span></div>
                                <input type="range" id="opacitySlider" min="0" max="100" value="90" class="w-full rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>

                        <!-- Hoofdicoon -->
                        <div class="p-4 bg-white rounded-2xl border border-slate-100 space-y-3">
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-400 uppercase">Hoofdicoon</label>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="setConfig('icon', 'ü•æ')" class="p-3 text-2xl bg-slate-50 border border-slate-200 rounded-lg shadow-sm hover:bg-emerald-50 transition-all">ü•æ</button>
                                    <button onclick="setConfig('icon', 'üö∂')" class="p-3 text-2xl bg-slate-50 border border-slate-200 rounded-lg shadow-sm hover:bg-emerald-50 transition-all">üö∂</button>
                                    <button onclick="setConfig('icon', 'üèîÔ∏è')" class="p-3 text-2xl bg-slate-50 border border-slate-200 rounded-lg shadow-sm hover:bg-emerald-50 transition-all">üèîÔ∏è</button>
                                    <button onclick="setConfig('icon', 'üéí')" class="p-3 text-2xl bg-slate-50 border border-slate-200 rounded-lg shadow-sm hover:bg-emerald-50 transition-all">üéí</button>
                                    <button onclick="setConfig('icon', 'üëü')" class="p-3 text-2xl bg-slate-50 border border-slate-200 rounded-lg shadow-sm hover:bg-emerald-50 transition-all">üëü</button>
                                    <button onclick="setConfig('icon', '')" class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg shadow-sm text-xs font-bold text-slate-300 uppercase hover:bg-emerald-50 transition-all">Uit</button>
                                </div>
                                <div class="space-y-1 mt-3">
                                    <div class="flex justify-between items-center">
                                        <label class="text-xs font-bold text-slate-400 uppercase">Grootte Icoon</label>
                                        <span id="iconSizeLabel" class="text-xs font-bold text-emerald-600">95px</span>
                                    </div>
                                    <input type="range" id="iconSizeSlider" min="40" max="180" value="95" class="w-full rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <!-- Weer & Terrein -->
                        <div class="p-4 bg-white rounded-2xl border border-slate-100">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-400 uppercase block">Weer</label>
                                    <div class="flex flex-wrap gap-1">
                                        <button onclick="setExtra('weather', '‚òÄÔ∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">‚òÄÔ∏è</button>
                                        <button onclick="setExtra('weather', '‚õÖ')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">‚õÖ</button>
                                        <button onclick="setExtra('weather', '‚òÅÔ∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">‚òÅÔ∏è</button>
                                        <button onclick="setExtra('weather', 'üåßÔ∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">üåßÔ∏è</button>
                                        <button onclick="setExtra('weather', '‚õàÔ∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">‚õàÔ∏è</button>
                                        <button onclick="setExtra('weather', '‚ùÑÔ∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">‚ùÑÔ∏è</button>
                                        <button onclick="setExtra('weather', 'üå´Ô∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">üå´Ô∏è</button>
                                        <button onclick="setExtra('weather', '')" class="px-2 py-1 bg-slate-50 border border-slate-100 rounded-md text-[10px] font-bold text-slate-300 uppercase">Uit</button>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-400 uppercase block">Terrein</label>
                                    <div class="flex flex-wrap gap-1">
                                        <button onclick="setExtra('terrain', 'üå≤')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">üå≤</button>
                                        <button onclick="setExtra('terrain', 'üèîÔ∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">üèîÔ∏è</button>
                                        <button onclick="setExtra('terrain', 'üõ£Ô∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">üõ£Ô∏è</button>
                                        <button onclick="setExtra('terrain', 'üèûÔ∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">üèûÔ∏è</button>
                                        <button onclick="setExtra('terrain', 'üå≥')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">üå≥</button>
                                        <button onclick="setExtra('terrain', '‚õ∞Ô∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">‚õ∞Ô∏è</button>
                                        <button onclick="setExtra('terrain', 'üèïÔ∏è')" class="p-2 text-xl bg-slate-50 border border-slate-100 rounded-md hover:bg-emerald-50 transition-all">üèïÔ∏è</button>
                                        <button onclick="setExtra('terrain', '')" class="px-2 py-1 bg-slate-50 border border-slate-100 rounded-md text-[10px] font-bold text-slate-300 uppercase">Uit</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-400 uppercase">Accentkleur</label>
                                <div class="flex gap-2">
                                    <button onclick="setConfig('color', '#10b981')" class="w-12 h-12 rounded-full bg-emerald-500 border-2 border-white ring-1 ring-slate-200 shadow-sm"></button>
                                    <button onclick="setConfig('color', '#3b82f6')" class="w-12 h-12 rounded-full bg-blue-500 border-2 border-white ring-1 ring-slate-200 shadow-sm"></button>
                                    <button onclick="setConfig('color', '#e11d48')" class="w-12 h-12 rounded-full bg-rose-600 border-2 border-white ring-1 ring-slate-200 shadow-sm"></button>
                                    <button onclick="setConfig('color', '#000000')" class="w-12 h-12 rounded-full bg-black border-2 border-white ring-1 ring-slate-200 shadow-sm"></button>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-400 uppercase">Kaart Mode</label>
                                <div class="flex gap-1 bg-slate-100 p-1 rounded-lg">
                                    <button onclick="setConfig('theme', 'light')" id="theme-light" class="flex-1 py-2 text-xs font-bold uppercase rounded-md bg-white shadow-sm transition-all">Licht</button>
                                    <button onclick="setConfig('theme', 'dark')" id="theme-dark" class="flex-1 py-2 text-xs font-bold uppercase rounded-md text-slate-400 transition-all">Donker</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Acties -->
                    <div class="mt-8 pt-6 border-t border-slate-100 space-y-4">
                        <label for="bgUpload" class="w-full flex items-center justify-center gap-2 py-4 border-2 border-dashed border-slate-200 rounded-3xl text-slate-400 text-sm font-bold cursor-pointer hover:bg-slate-50 transition-all active:scale-95 group">
                            <svg class="group-hover:text-emerald-500 transition-colors" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                            TEST OP JE EIGEN FOTO
                        </label>
                        <input type="file" id="bgUpload" accept="image/*">

                        <button id="downloadBtn" class="w-full bg-slate-900 text-white font-black py-5 rounded-3xl shadow-xl hover:bg-emerald-600 transition-all flex items-center justify-center gap-3 transform active:scale-95">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                            DOWNLOAD STORY PNG
                        </button>

                        <button onclick="toggleResetModal(true)" class="w-full text-slate-300 hover:text-red-400 font-bold text-xs uppercase tracking-widest py-3 transition-colors">
                            Alles wissen / Opnieuw beginnen
                        </button>
                    </div>
                </div>
            </div>

            <!-- PREVIEW -->
            <div class="w-full lg:w-2/5 flex flex-col items-center">
                <div class="sticky top-10 w-full flex flex-col items-center">
                    <p class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 bg-white px-4 py-2 rounded-full shadow-sm border border-slate-100">Live Preview</p>
                    <div class="canvas-container shadow-2xl overflow-hidden bg-slate-200 border-[8px] border-white rounded-[45px]">
                        <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 20px 20px;"></div>
                        <canvas id="canvasPreview"></canvas>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvasPreview');
        const ctx = canvas.getContext('2d');
        const downloadBtn = document.getElementById('downloadBtn');
        const bgUpload = document.getElementById('bgUpload');
        const logoUpload = document.getElementById('logoUpload');
        const showLogoInput = document.getElementById('showLogoInput');
        const showYearInput = document.getElementById('showYearInput');
        const showTitleInput = document.getElementById('showTitleInput');
        const titleCheckInput = document.getElementById('titleCheckInput');
        const yearTextInput = document.getElementById('yearTextInput');
        const yearSizeSlider = document.getElementById('yearSizeSlider');
        const yearSizeLabel = document.getElementById('yearSizeLabel');
        const titleSizeSlider = document.getElementById('titleSizeSlider');
        const titleSizeLabel = document.getElementById('titleSizeLabel');
        const opacitySlider = document.getElementById('opacitySlider');
        const resetModal = document.getElementById('resetModal');

        const widthSlider = document.getElementById('widthSlider');
        const heightSlider = document.getElementById('heightSlider');
        const posSlider = document.getElementById('posSlider');

        const STORAGE_KEY = 'wandelbadge_config_v1';

        // Debounce function for performance optimization
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        const DEFAULT_CONFIG = {
            title: 'WandelChallenge',
            showTitle: true,
            titleFont: 'Inter',
            titleSize: 52,
            titleBold: true,
            titleItalic: false,
            titleCheck: false,
            yearText: '2026',
            yearFont: 'Inter',
            yearBold: true,
            yearItalic: false,
            yearSize: 180,
            showYear: true,
            km: 25,
            kmFont: 'Inter',
            kmSize: 85,
            kmBold: true,
            kmItalic: false,
            target: 2026,
            day: '',
            steps: '',
            handle: '',
            color: '#10b981',
            theme: 'light',
            icon: '',
            iconSize: 95,
            goalFont: 'Inter',
            goalSize: 45,
            goalBold: true,
            goalItalic: false,
            opacity: 0.90,
            showLogo: true,
            logoType: 'fightcancer',
            customLogoBase64: null,
            bgImage: null,
            customLogoImg: null,
            fightCancerLogoImg: null,
            weather: '',
            terrain: '',
            wScale: 1.0,
            hScale: 0.9,
            yPos: 1300
        };

        let config = JSON.parse(JSON.stringify(DEFAULT_CONFIG));

        canvas.width = 1080;
        canvas.height = 1920;

        // Load Fight Cancer logo
        const fightCancerLogo = new Image();
        fightCancerLogo.onload = () => {
            config.fightCancerLogoImg = fightCancerLogo;
            draw();
        };
        fightCancerLogo.onerror = () => {
            console.warn('Failed to load Fight Cancer logo');
        };
        fightCancerLogo.src = 'fight_cancer_logo.png';

        function saveToCache() {
            const toSave = { ...config };
            delete toSave.bgImage;
            delete toSave.customLogoImg;
            delete toSave.fightCancerLogoImg;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(toSave));
        }

        function loadFromCache() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const parsed = JSON.parse(saved);
                config = { ...config, ...parsed };
                updateUIFromConfig();
            } else {
                updateUIFromConfig();
            }
        }

        function toggleResetModal(show) { resetModal.style.display = show ? 'flex' : 'none'; }

        function resetData() {
            localStorage.removeItem(STORAGE_KEY);
            config = JSON.parse(JSON.stringify(DEFAULT_CONFIG));
            updateUIFromConfig();
            toggleResetModal(false);
            draw();
        }

        function updateUIFromConfig() {
            document.getElementById('kmInput').value = config.km;
            document.getElementById('targetInput').value = config.target || 2026;
            document.getElementById('dayInput').value = config.day || '';
            document.getElementById('stepsInput').value = config.steps || '';
            document.getElementById('titleInput').value = config.title;
            document.getElementById('yearTextInput').value = config.yearText;
            document.getElementById('showYearInput').checked = config.showYear;
            document.getElementById('showTitleInput').checked = config.showTitle;
            document.getElementById('titleCheckInput').checked = config.titleCheck || false;
            document.getElementById('handleInput').value = config.handle || '';
            document.getElementById('showLogoInput').checked = config.showLogo;

            document.getElementById('opacitySlider').value = config.opacity * 100;
            document.getElementById('opacityLabel').innerText = `${Math.round(config.opacity * 100)}%`;

            document.getElementById('widthSlider').value = config.wScale * 100;
            document.getElementById('widthLabel').innerText = `${Math.round(config.wScale * 100)}%`;

            document.getElementById('heightSlider').value = config.hScale * 100;
            document.getElementById('heightLabel').innerText = `${Math.round(config.hScale * 100)}%`;

            document.getElementById('posSlider').value = config.yPos;
            updatePosLabel(config.yPos);

            document.getElementById('yearSizeSlider').value = config.yearSize;
            document.getElementById('yearSizeLabel').innerText = `${config.yearSize}px`;

            document.getElementById('titleSizeSlider').value = config.titleSize;
            document.getElementById('titleSizeLabel').innerText = `${config.titleSize}px`;

            document.getElementById('iconSizeSlider').value = config.iconSize || 95;
            document.getElementById('iconSizeLabel').innerText = `${config.iconSize || 95}px`;

            document.getElementById('kmSizeSlider').value = config.kmSize || 85;
            document.getElementById('kmSizeLabel').innerText = `${config.kmSize || 85}px`;

            document.getElementById('goalSizeSlider').value = config.goalSize || 45;
            document.getElementById('goalSizeLabel').innerText = `${config.goalSize || 45}px`;

            document.getElementById('titleFontSelect').value = config.titleFont;
            document.getElementById('yearFontSelect').value = config.yearFont;
            document.getElementById('kmFontSelect').value = config.kmFont || 'Inter';
            document.getElementById('goalFontSelect').value = config.goalFont || 'Inter';
            updateStyleButtons();

            if (config.customLogoBase64) {
                const img = new Image();
                img.onload = () => { config.customLogoImg = img; draw(); };
                img.onerror = () => {
                    console.warn('Failed to load cached logo, clearing from storage');
                    config.customLogoBase64 = null;
                    config.customLogoImg = null;
                    saveToCache();
                };
                img.src = config.customLogoBase64;
            } else {
                config.customLogoImg = null;
            }

            updateThemeButtons();
            setLogoType(config.logoType);
        }

        function updatePosLabel(val) {
             const label = document.getElementById('posLabel');
             if (val < 600) label.innerText = 'Hoog';
             else if (val > 1200) label.innerText = 'Laag';
             else label.innerText = 'Midden';
        }

        function setConfig(key, val) {
            config[key] = val;
            if (key === 'theme') updateThemeButtons();
            draw();
            saveToCache();
        }

        function toggleStyle(key) {
            config[key] = !config[key];
            updateStyleButtons();
            draw();
            saveToCache();
        }

        function updateStyleButtons() {
            document.getElementById('titleBoldBtn').classList.toggle('active', config.titleBold);
            document.getElementById('titleItalicBtn').classList.toggle('active', config.titleItalic);
            document.getElementById('yearBoldBtn').classList.toggle('active', config.yearBold);
            document.getElementById('yearItalicBtn').classList.toggle('active', config.yearItalic);
            document.getElementById('kmBoldBtn').classList.toggle('active', config.kmBold);
            document.getElementById('kmItalicBtn').classList.toggle('active', config.kmItalic);
            document.getElementById('goalBoldBtn').classList.toggle('active', config.goalBold);
            document.getElementById('goalItalicBtn').classList.toggle('active', config.goalItalic);
        }

        function setExtra(key, val) {
            config[key] = val;
            draw();
            saveToCache();
        }

        function updateThemeButtons() {
            const lightBtn = document.getElementById('theme-light');
            const darkBtn = document.getElementById('theme-dark');
            if (config.theme === 'light') {
                lightBtn.className = "flex-1 py-1 text-[10px] font-bold uppercase rounded-md bg-white shadow-sm transition-all";
                darkBtn.className = "flex-1 py-1 text-[10px] font-bold uppercase rounded-md text-slate-400 transition-all";
            } else {
                darkBtn.className = "flex-1 py-1 text-[10px] font-bold uppercase rounded-md bg-white shadow-sm transition-all";
                lightBtn.className = "flex-1 py-1 text-[10px] font-bold uppercase rounded-md text-slate-400 transition-all";
            }
        }

        function setLogoType(type) {
            config.logoType = type;
            const fcBtn = document.getElementById('logo-fc');
            const customBtn = document.getElementById('logo-custom');
            if(type === 'fightcancer') {
                fcBtn.className = "py-3 text-xs font-bold rounded-lg border-2 border-emerald-600 bg-white text-emerald-600 transition-all";
                customBtn.className = "py-3 text-xs font-bold rounded-lg border-2 border-slate-200 bg-white text-slate-400 hover:border-emerald-200 transition-all";
            } else if(type === 'custom') {
                customBtn.className = "py-3 text-xs font-bold rounded-lg border-2 border-emerald-600 bg-white text-emerald-600 transition-all";
                fcBtn.className = "py-3 text-xs font-bold rounded-lg border-2 border-slate-200 bg-white text-slate-400 hover:border-emerald-200 transition-all";
            }
            draw(); saveToCache();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('btn-' + tab).classList.add('active');
        }

        // Create debounced versions for text inputs
        const debouncedDraw = debounce(() => { draw(); saveToCache(); }, 150);

        // Sliders & Inputs (sliders don't use debounce for immediate feedback)
        widthSlider.addEventListener('input', (e) => { config.wScale = e.target.value / 100; document.getElementById('widthLabel').innerText = `${e.target.value}%`; draw(); saveToCache(); });
        heightSlider.addEventListener('input', (e) => { config.hScale = e.target.value / 100; document.getElementById('heightLabel').innerText = `${e.target.value}%`; draw(); saveToCache(); });
        posSlider.addEventListener('input', (e) => { config.yPos = parseInt(e.target.value); updatePosLabel(config.yPos); draw(); saveToCache(); });
        yearSizeSlider.addEventListener('input', (e) => { config.yearSize = parseInt(e.target.value); yearSizeLabel.innerText = `${config.yearSize}px`; draw(); saveToCache(); });
        titleSizeSlider.addEventListener('input', (e) => { config.titleSize = parseInt(e.target.value); titleSizeLabel.innerText = `${config.titleSize}px`; draw(); saveToCache(); });

        const iconSizeSlider = document.getElementById('iconSizeSlider');
        const iconSizeLabel = document.getElementById('iconSizeLabel');
        iconSizeSlider.addEventListener('input', (e) => { config.iconSize = parseInt(e.target.value); iconSizeLabel.innerText = `${config.iconSize}px`; draw(); saveToCache(); });

        const goalSizeSlider = document.getElementById('goalSizeSlider');
        const goalSizeLabel = document.getElementById('goalSizeLabel');
        goalSizeSlider.addEventListener('input', (e) => { config.goalSize = parseInt(e.target.value); goalSizeLabel.innerText = `${config.goalSize}px`; draw(); saveToCache(); });

        const kmSizeSlider = document.getElementById('kmSizeSlider');
        const kmSizeLabel = document.getElementById('kmSizeLabel');
        kmSizeSlider.addEventListener('input', (e) => { config.kmSize = parseInt(e.target.value); kmSizeLabel.innerText = `${config.kmSize}px`; draw(); saveToCache(); });

        const kmFontSelect = document.getElementById('kmFontSelect');
        kmFontSelect.addEventListener('change', (e) => { config.kmFont = e.target.value; draw(); saveToCache(); });

        document.querySelectorAll('input:not([type="file"]):not([type="range"]):not([type="checkbox"])').forEach(input => {
            input.addEventListener('input', (e) => {
                const key = e.target.id.replace('Input', '');
                config[key] = e.target.value;
                debouncedDraw();
            });
        });

        showLogoInput.addEventListener('change', (e) => { config.showLogo = e.target.checked; draw(); saveToCache(); });
        showYearInput.addEventListener('change', (e) => { config.showYear = e.target.checked; draw(); saveToCache(); });
        showTitleInput.addEventListener('change', (e) => { config.showTitle = e.target.checked; draw(); saveToCache(); });
        titleCheckInput.addEventListener('change', (e) => { config.titleCheck = e.target.checked; draw(); saveToCache(); });
        opacitySlider.addEventListener('input', (e) => { config.opacity = e.target.value / 100; document.getElementById('opacityLabel').innerText = `${e.target.value}%`; draw(); saveToCache(); });

        bgUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) {
                alert('Selecteer een geldig afbeeldingsbestand.');
                return;
            }
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => { config.bgImage = img; draw(); };
                img.onerror = () => { alert('Kan afbeelding niet laden. Probeer een ander bestand.'); };
                img.src = ev.target.result;
            };
            reader.onerror = () => { alert('Fout bij het lezen van het bestand.'); };
            reader.readAsDataURL(file);
        });

        logoUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) {
                alert('Selecteer een geldig afbeeldingsbestand.');
                return;
            }
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    config.customLogoImg = img;
                    config.customLogoBase64 = ev.target.result;
                    setLogoType('custom');
                };
                img.onerror = () => { alert('Kan logo niet laden. Probeer een ander bestand.'); };
                img.src = ev.target.result;
            };
            reader.onerror = () => { alert('Fout bij het lezen van het bestand.'); };
            reader.readAsDataURL(file);
        });

        function formatNumber(num) { return num ? num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") : "0"; }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (config.bgImage) {
                const scale = Math.max(canvas.width / config.bgImage.width, canvas.height / config.bgImage.height);
                ctx.drawImage(config.bgImage, (canvas.width - config.bgImage.width * scale) / 2, (canvas.height - config.bgImage.height * scale) / 2, config.bgImage.width * scale, config.bgImage.height * scale);
            }

            const baseMargin = 100;
            const baseWidth = canvas.width - (baseMargin * 2);
            const wW = baseWidth * config.wScale;
            const wH = 760 * config.hScale;
            const wX = (canvas.width - wW) / 2;
            const wY = canvas.height - config.yPos;

            // Kaart Background
            ctx.save();
            ctx.shadowBlur = 80; ctx.shadowColor = 'rgba(0,0,0,0.3)';
            ctx.fillStyle = config.theme === 'light' ? `rgba(255, 255, 255, ${config.opacity})` : `rgba(15, 23, 42, ${config.opacity})`;
            roundRect(ctx, wX, wY, wW, wH, 80 * config.wScale, true);
            ctx.restore();

            const perc = Math.min(parseInt(config.km || 0) / config.target, 1);

            // Koptekst boven kaart
            if (config.showYear && config.yearText) {
                ctx.save();
                ctx.fillStyle = config.color;
                ctx.font = `${config.yearBold ? '900' : '400'} ${config.yearItalic ? 'italic' : ''} ${config.yearSize * config.wScale}px ${config.yearFont}`;
                ctx.textAlign = 'center';
                ctx.shadowBlur = 15; ctx.shadowColor = 'rgba(0,0,0,0.1)';
                ctx.fillText(config.yearText, canvas.width/2, wY - 60);
                ctx.restore();
            }

            // Badge
            const badgeRadius = 95 * config.wScale;
            ctx.fillStyle = config.color;
            ctx.beginPath(); ctx.arc(wX + wW - 60, wY + 60, badgeRadius, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = 'white'; ctx.font = `900 ${52 * config.wScale}px Inter`; ctx.textAlign = 'center';
            ctx.fillText(`${Math.round(perc * 100)}%`, wX + wW - 60, wY + 65);
            ctx.font = `700 ${20 * config.wScale}px Inter`; ctx.fillText('KLAAR', wX + wW - 60, wY + 105);

            // Dynamic Y positioning based on icon presence
            let contentStartY = config.icon ? wY + 130 : wY + 60;

            // Icon (only if not empty)
            if (config.icon) {
                ctx.font = `${config.iconSize * config.wScale}px Arial`; ctx.textAlign = 'center';
                ctx.fillText(config.icon, canvas.width/2, contentStartY);
            }

            // Titel met Styling
            if (config.showTitle && config.title) {
                ctx.fillStyle = config.theme === 'light' ? '#0f172a' : '#f8fafc';
                ctx.font = `${config.titleBold ? '900' : '400'} ${config.titleItalic ? 'italic' : ''} ${config.titleSize * config.wScale}px ${config.titleFont}`;
                ctx.textAlign = 'center';

                const titleX = canvas.width / 2;
                const titleY = config.icon ? wY + 220 : wY + 150;
                ctx.fillText(config.title, titleX, titleY);

                if (config.titleCheck) {
                    const textWidth = ctx.measureText(config.title).width;
                    const checkX = titleX + (textWidth / 2) + (25 * config.wScale);
                    const checkY = titleY - (15 * config.wScale);
                    const checkSize = 20 * config.wScale;

                    ctx.save();
                    ctx.fillStyle = '#10b981';
                    ctx.beginPath(); ctx.arc(checkX, checkY, checkSize, 0, Math.PI * 2); ctx.fill();
                    ctx.strokeStyle = 'white'; ctx.lineWidth = 4 * config.wScale; ctx.lineCap = 'round'; ctx.beginPath();
                    ctx.moveTo(checkX - checkSize/2.5, checkY); ctx.lineTo(checkX - checkSize/10, checkY + checkSize/3);
                    ctx.lineTo(checkX + checkSize/2, checkY - checkSize/4); ctx.stroke();
                    ctx.restore();
                }
            }

            // Bar - position dynamically based on icon presence
            const bX = wX + (80 * config.wScale);
            const bY = config.icon ? wY + 310 : wY + 240;
            const bW = wW - (160 * config.wScale);
            const bH = 55;
            ctx.fillStyle = config.theme === 'light' ? '#f1f5f9' : '#334155';
            roundRect(ctx, bX, bY, bW, bH, 27, true);
            if (perc > 0.01) {
                ctx.fillStyle = config.color;
                roundRect(ctx, bX, bY, Math.max(bW * perc, 54), bH, 27, true);
            }

            // Kilometers
            ctx.fillStyle = config.theme === 'light' ? '#0f172a' : '#f8fafc';
            ctx.font = `${config.kmBold ? '900' : '400'} ${config.kmItalic ? 'italic' : ''} ${config.kmSize * config.wScale}px ${config.kmFont}`;
            ctx.textAlign = 'left';
            ctx.fillText(`${formatNumber(config.km || 0)} km`, bX, bY + 160);
            ctx.fillStyle = '#94a3b8';
            ctx.font = `${config.goalBold ? '700' : '400'} ${config.goalItalic ? 'italic' : ''} ${config.goalSize * config.wScale}px ${config.goalFont}`;
            ctx.textAlign = 'right';
            ctx.fillText(`DOEL: ${formatNumber(config.target)}`, bX + bW, bY + 160);

            // Dynamic spacing for bottom elements - adjust based on icon presence
            let bottomY = config.icon ? bY + 255 : bY + 235;
            ctx.textAlign = 'left';
            if (config.day) {
                ctx.fillStyle = config.color; ctx.font = `900 ${42 * config.wScale}px Inter`;
                ctx.fillText(`DAG ${config.day}`, bX, bottomY); bottomY += 55;
            }
            if (config.steps) {
                ctx.fillStyle = config.theme === 'light' ? '#64748b' : '#94a3b8'; ctx.font = `bold ${38 * config.wScale}px Inter`;
                ctx.fillText(`üë£ ${formatNumber(config.steps)} STAPPEN`, bX, bottomY); bottomY += 55;
            }
            if (config.handle) {
                ctx.fillStyle = config.color; ctx.font = `900 ${36 * config.wScale}px Inter`;
                ctx.fillText(config.handle.toUpperCase(), bX, bottomY + 10);
            }

            if (config.weather || config.terrain) {
                ctx.font = `${50 * config.wScale}px Arial`;
                ctx.textAlign = 'right';
                const weatherY = config.icon ? bY + 250 : bY + 230;
                ctx.fillText(`${config.weather} ${config.terrain}`, bX + bW, weatherY);
            }

            if (config.showLogo) {
                const lS = 110 * config.wScale; const lX = wX + wW - lS - 60; const lY = wY + wH - lS - 60;
                if (config.logoType === 'fightcancer' && config.fightCancerLogoImg) {
                    ctx.drawImage(config.fightCancerLogoImg, lX, lY, lS, lS);
                } else if (config.logoType === 'custom' && config.customLogoImg) {
                    ctx.drawImage(config.customLogoImg, lX, lY, lS, lS);
                }
            }
        }

        function roundRect(ctx, x, y, width, height, radius, fill) {
            ctx.beginPath(); ctx.moveTo(x + radius, y); ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius); ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height); ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius); ctx.lineTo(x, y + radius); ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath(); if (fill) ctx.fill();
        }

        downloadBtn.addEventListener('click', () => {
            const currentBg = config.bgImage; config.bgImage = null; draw();
            const link = document.createElement('a');
            link.download = `WandelProgressie_Update.png`;
            link.href = canvas.toDataURL('image/png', 1.0); link.click();
            config.bgImage = currentBg; draw();
        });

        loadFromCache();
        draw();
    </script>
</body>
</html>